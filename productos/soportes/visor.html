<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Personalizador 3D - Kreoma3D</title>

<style>
:root{
  --border:#dadada;
  --shadow:0 8px 25px rgba(0,0,0,.20);
  --panel-bg:rgba(255,255,255,0.96);
}

*{margin:0;padding:0;box-sizing:border-box;}
body{
  width:100vw;
  height:100vh;
  overflow:hidden;
  background:#e8e8e8;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}

/* CONTENEDOR SUPERIOR = VISOR 3D */
#visor{
  position:relative;
  width:100%;
  height:60vh;
  background:transparent;
  overflow:hidden;
}

/* LOGO DETR√ÅS DE LA PIEZA */
#visor-logo{
  position:absolute;
  inset:0;
  background:url("logo_kreoma.png") center center no-repeat;
  background-size:65vmin;
  opacity:.08;
  pointer-events:none;
  z-index:1;
  filter:blur(0.5px);
}

/* EL CANVAS DEL 3D */
#lienzo3d{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  z-index:5;
  filter:drop-shadow(0px 18px 35px rgba(0,0,0,.35));
}

/* PANEL INFERIOR FIJO */
#panel{
  position:fixed;
  bottom:0; left:0; right:0;
  height:40vh;
  background:var(--panel-bg);
  border-top:1px solid var(--border);
  box-shadow:0 -5px 28px rgba(0,0,0,.25);
  padding:18px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* SECCI√ìN: BLOQUE DE COLORES */
.bloque{
  display:flex;
  flex-direction:column;
  gap:6px;
}

.bloque h3{
  font-size:14px;
  font-weight:700;
  letter-spacing:.4px;
}

.colores{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

.color{
  width:34px;
  height:34px;
  border-radius:50%;
  border:2px solid #fff;
  box-shadow:0 0 5px rgba(0,0,0,.25);
  cursor:pointer;
}

.color.sel{
  outline:3px solid #000;
}

/* LOGO */
select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:15px;
}

/* BOT√ìN WHATSAPP */
button{
  width:100%; 
  padding:14px;
  background:#25D366;
  color:#fff;
  border:none;
  font-size:16px;
  font-weight:700;
  border-radius:12px;
  cursor:pointer;
}
button:hover{background:#1ebe5c;}

</style>
</head>

<body>

<div id="visor">
  <div id="visor-logo"></div>
  <div id="lienzo3d"></div>
</div>

<div id="panel">

  <div class="bloque">
    <h3>Color Base</h3>
    <div class="colores" id="cb"></div>
  </div>

  <div class="bloque">
    <h3>Color Superior</h3>
    <div class="colores" id="cs"></div>
  </div>

  <div class="bloque">
    <h3>Color Insertos</h3>
    <div class="colores" id="ci"></div>
  </div>

  <div class="bloque">
    <h3>Logo</h3>
    <select id="logo-select"></select>
  </div>

  <div class="bloque">
    <h3>Color Logo</h3>
    <div class="colores" id="cl"></div>
  </div>

  <button id="enviarWhatsApp">Enviar Personalizaci√≥n a WhatsApp</button>

</div>

<script type="module">
/* =======================
   IMPORTS
======================= */
import * as THREE from "./libs/three.module.js";
import { STLLoader } from "./libs/STLLoader.js";
import { OrbitControls } from "./libs/OrbitControls.js";

/* =======================
   ESCENA
======================= */
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/(window.innerHeight*0.60), 0.1, 10000);
camera.position.set(-200,0,200);

const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
renderer.setClearColor(0x000000,0);
renderer.setSize(window.innerWidth, window.innerHeight*0.60);
document.getElementById("lienzo3d").appendChild(renderer.domElement);

const hemi = new THREE.HemisphereLight(0xffffff, 0x777777, 1.3);
scene.add(hemi);

const dir = new THREE.DirectionalLight(0xffffff, 0.8);
dir.position.set(1,1,1);
scene.add(dir);

scene.add(new THREE.AmbientLight(0xffffff,0.35));

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.06;

/* =======================
   GRUPO
======================= */
const world = new THREE.Group();
world.position.y = -160;
world.position.x = 170;
scene.add(world);

/* =======================
   CARGA STL
======================= */
const loader = new STLLoader();
const piezas = {
  base:{file:"Helm-Wandhalter.stl",mesh:null},
  superior:{file:"Helm-Halter.stl",mesh:null},
  inserts:["Insert1.stl","Insert2.stl","Insert3.stl","Insert4.stl","Insert5.stl"],
  insertMeshes:[],
  logo:{mesh:null}
};

function cargarSTL(){
  loader.load(piezas.base.file,g=>{
    const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:"#000",metalness:.4,roughness:.35}));
    m.rotation.x=Math.PI; m.rotation.z=Math.PI;
    world.add(m);
    piezas.base.mesh=m;
  });

  loader.load(piezas.superior.file,g=>{
    const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:"#ff8000",metalness:.4,roughness:.35}));
    m.rotation.x=Math.PI; m.rotation.z=Math.PI;
    world.add(m);
    piezas.superior.mesh=m;
  });

  piezas.inserts.forEach(f=>{
    loader.load(f,g=>{
      const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:"#ff8000",metalness:.4,roughness:.35}));
      m.rotation.x=Math.PI; m.rotation.z=Math.PI;
      world.add(m);
      piezas.insertMeshes.push(m);
    });
  });

  cargarLogo("logoYamaha.stl","#ff8000");
}

function cargarLogo(archivo,color){
  if(piezas.logo.mesh){
    world.remove(piezas.logo.mesh);
    piezas.logo.mesh.geometry.dispose();
    piezas.logo.mesh.material.dispose();
    piezas.logo.mesh=null;
  }
  if(!archivo) return;

  loader.load(archivo,g=>{
    const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color,metalness:.4,roughness:.35}));
    m.rotation.x=Math.PI;
    m.rotation.z=Math.PI;
    m.position.set(11,-15,-5);
    world.add(m);
    piezas.logo.mesh=m;
  });
}

/* =======================
   COLORES
======================= */
const colores=[
  {n:"Amarillo",c:"#ffff00"},
  {n:"Blanco",c:"#ffffff"},
  {n:"Negro",c:"#000000"},
  {n:"Azul",c:"#0000ff"},
  {n:"Verde lim√≥n",c:"#ccff00"},
  {n:"Rosado",c:"#ff66cc"},
  {n:"Morado",c:"#8000ff"},
  {n:"Caf√©",c:"#8b4513"},
  {n:"Rojo",c:"#ff0000"},
  {n:"Gris",c:"#808080"},
  {n:"Naranjado",c:"#ff8000"}
];

function crearBloqueColor(id,grupo){
  const cont=document.getElementById(id);
  colores.forEach(col=>{
    const div=document.createElement("div");
    div.className="color";
    div.style.background=col.c;

    div.addEventListener("click",()=>{
      cont.querySelectorAll(".color").forEach(x=>x.classList.remove("sel"));
      div.classList.add("sel");

      if(grupo==="base" && piezas.base.mesh)
        piezas.base.mesh.material.color.set(col.c);
      if(grupo==="superior" && piezas.superior.mesh)
        piezas.superior.mesh.material.color.set(col.c);
      if(grupo==="insert")
        piezas.insertMeshes.forEach(x=>x.material.color.set(col.c));
      if(grupo==="logo" && piezas.logo.mesh)
        piezas.logo.mesh.material.color.set(col.c);
    });

    cont.appendChild(div);
  });
}

/* =======================
   SELECT LOGOS
======================= */
const listaLogos=[
  {n:"Yamaha",f:"logoYamaha.stl"},
  {n:"Sin logo",f:""},
  {n:"Nmax",f:"logoNmax.stl"},
  {n:"V-Strom",f:"logoVstrom.stl"},
  {n:"Ktm",f:"logoKtm.stl"},
  {n:"FOX",f:"logoFox.stl"},
  {n:"Monster",f:"logoMonster.stl"},
  {n:"Nike",f:"logoNike.stl"},
  {n:"Honda",f:"logoHonda.stl"},
  {n:"Suzuki",f:"logoSuzuki.stl"},
  {n:"Pulsar",f:"logoPulsar.stl"},
  {n:"AKT",f:"logoAKT.stl"},
  {n:"Royal Enfield",f:"logoRoyal.stl"},
  {n:"Dominar",f:"logoDominar.stl"},
  {n:"Kawasaki",f:"logoKawasaki.stl"},
  {n:"Discover",f:"logoDiscover.stl"}
];

function crearSelectLogo(){
  const sel=document.getElementById("logo-select");
  listaLogos.forEach(l=>{
    const opt=document.createElement("option");
    opt.value=l.f;
    opt.textContent=l.n;
    sel.appendChild(opt);
  });
  sel.addEventListener("change",()=>{
    const archivo=sel.value;
    const col=document.querySelector("#cl .sel")?.style.background || "#ff8000";
    cargarLogo(archivo,col);
  });
}

/* =======================
   ENVIAR WHATSAPP
======================= */
document.getElementById("enviarWhatsApp").addEventListener("click",()=>{
  const base=document.querySelector("#cb .sel")?.style.background || "N/A";
  const sup=document.querySelector("#cs .sel")?.style.background || "N/A";
  const ins=document.querySelector("#ci .sel")?.style.background || "N/A";
  const colLogo=document.querySelector("#cl .sel")?.style.background || "N/A";
  const logo=document.getElementById("logo-select").selectedOptions[0].textContent;

  const msg=`Hola Kreoma3D! üëã\nQuiero mi soporte personalizado:\n‚Ä¢ Base: ${base}\n‚Ä¢ Superior: ${sup}\n‚Ä¢ Insertos: ${ins}\n‚Ä¢ Logo: ${logo} (${colLogo})`;

  window.open(`https://wa.me/573332395481?text=${encodeURIComponent(msg)}`,"_blank");
});

/* =======================
   START
======================= */
cargarSTL();
crearBloqueColor("cb","base");
crearBloqueColor("cs","superior");
crearBloqueColor("ci","insert");
crearBloqueColor("cl","logo");
crearSelectLogo();

function render(){
  requestAnimationFrame(render);
  controls.update();
  renderer.render(scene,camera);
}
render();

window.addEventListener("resize",()=>{
  renderer.setSize(window.innerWidth, window.innerHeight*0.60);
  camera.aspect=window.innerWidth/(window.innerHeight*0.60);
  camera.updateProjectionMatrix();
});
</script>

</body>
</html>
