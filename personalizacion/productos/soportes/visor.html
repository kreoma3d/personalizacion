<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Visor Soporte de Casco 3D - Kreoma3D</title>
  <style>
    :root{
      --panel:#ffffffee; --txt:#111; --border:#e6e6e6;
      --shadow:0 10px 25px rgba(0,0,0,.18);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      height:100vh; overflow:hidden;
      background:#ccc; color:var(--txt);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    .bg-logo{
      position:fixed; inset:0; z-index:0;
      background:url('logo_kreoma.png') center center no-repeat;
      background-size:150vmin;
      opacity:0.05;
      pointer-events:none;
    }

    .topbar{
      position:fixed; top:0; left:0; right:0; height:56px; z-index:20;
      display:flex; align-items:center; gap:12px; padding:0 16px;
      background:#fff; border-bottom:1px solid var(--border); box-shadow:var(--shadow);
    }
    .topbar img{height:34px}

    #panel{
      position:fixed; top:72px; left:16px; z-index:10;
      background:var(--panel); border:1px solid var(--border);
      padding:14px 16px; border-radius:14px; box-shadow:var(--shadow); width:360px;
      backdrop-filter:saturate(1.2) blur(6px);
    }
    h3{margin:8px 0 6px; font-size:13px; text-transform:uppercase; letter-spacing:.6px}
    select{
      width:100%; padding:8px 10px; margin-bottom:10px;
      border-radius:8px; border:1px solid var(--border);
      font-size:14px; cursor:pointer; background:#fff;
    }
    option::before{content:"⬤ ";}
  </style>
</head>
<body>
  <div class="bg-logo"></div>

  <div class="topbar">
    <img src="logo_kreoma.png" alt="Kreoma3D" />
    <h1>Personalizador 3D • Soporte de casco</h1>
  </div>

  <div id="panel">
    <h3>Color Base</h3>
    <select id="color-base"></select>
    <h3>Color Superior</h3>
    <select id="color-superior"></select>
    <h3>Color Insertos</h3>
    <select id="color-insert"></select>
  </div>

  <script type="module">
    import * as THREE from './libs/three.module.js';
    import { STLLoader } from './libs/STLLoader.js';
    import { OrbitControls } from './libs/OrbitControls.js';

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 10000);
    camera.position.set(0,250,400);

    const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setClearColor(0x000000, 0);
    renderer.setSize(innerWidth, innerHeight);
    renderer.outputEncoding = THREE.sRGBEncoding;
    document.body.appendChild(renderer.domElement);

    const hemi = new THREE.HemisphereLight(0xffffff, 0x888888, 1.3);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.9);
    dir.position.set(1,1,1);
    scene.add(dir);
    scene.add(new THREE.AmbientLight(0xffffff, 0.4));

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.07;

    const worldGroup = new THREE.Group();
    worldGroup.position.y = -160; // bajar pieza sin afectar orientación
    worldGroup.position.x = 120;
    scene.add(worldGroup);

    const loader = new STLLoader();

    const piezas = {
      base: { file:'Helm-Wandhalter.stl', mesh:null },
      superior: { file:'Helm-Halter.stl', mesh:null },
      inserts: ['Insert1.stl','Insert2.stl','Insert3.stl','Insert4.stl','Insert5.stl'],
      insertMeshes:[]
    };

    function cargar(){
      loader.load(piezas.base.file,g=>{
        const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:'#000',metalness:0.4,roughness:0.35}));
        m.rotation.x=Math.PI; m.rotation.z=Math.PI; worldGroup.add(m);
        piezas.base.mesh=m;
      });
      loader.load(piezas.superior.file,g=>{
        const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:'#ff8000',metalness:0.4,roughness:0.35}));
        m.rotation.x=Math.PI; m.rotation.z=Math.PI; worldGroup.add(m);
        piezas.superior.mesh=m;
      });
      piezas.inserts.forEach(f=>{
        loader.load(f,g=>{
          const m=new THREE.Mesh(g,new THREE.MeshStandardMaterial({color:'#ff8000',metalness:0.4,roughness:0.35}));
          m.rotation.x=Math.PI; m.rotation.z=Math.PI; worldGroup.add(m);
          piezas.insertMeshes.push(m);
        });
      });
    }
    cargar();

    const colores = [
      {n:'Amarillo',c:'#ffff00'},
      {n:'Blanco',c:'#ffffff'},
      {n:'Negro',c:'#000000'},
      {n:'Azul',c:'#0000ff'},
      {n:'Verde limón',c:'#ccff00'},
      {n:'Rosado',c:'#ff66cc'},
      {n:'Morado',c:'#8000ff'},
      {n:'Café',c:'#8b4513'},
      {n:'Rojo',c:'#ff0000'},
      {n:'Gris',c:'#808080'},
      {n:'Naranjado',c:'#ff8000'}
    ];

    function crearSelect(id, grupo, colorInicial){
  const sel=document.getElementById(id);
  colores.forEach(c=>{
    const opt=document.createElement('option');
    opt.value=c.c;
    opt.textContent=c.n;
    opt.style.background=c.c;
    opt.style.color=(parseInt(c.c.slice(1),16)>0xffffff/2)?'#000':'#fff';
    sel.appendChild(opt);
  });

  // valor inicial
  sel.value = colorInicial;

  sel.addEventListener('change',()=>{
    aplicarColor(grupo, sel.value);
  });
}

// función auxiliar para aplicar color
function aplicarColor(grupo, col){
  if(grupo==='base' && piezas.base.mesh) piezas.base.mesh.material.color.set(col);
  if(grupo==='superior' && piezas.superior.mesh) piezas.superior.mesh.material.color.set(col);
  if(grupo==='insert') piezas.insertMeshes.forEach(m=>m.material.color.set(col));
}

// inicializar selects con color por defecto
crearSelect('color-base','base','#000000');       // negro
crearSelect('color-superior','superior','#ff8000'); // naranjado
crearSelect('color-insert','insert','#ff8000');    // naranjado


    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene,camera);
    }
    animate();

    addEventListener('resize',()=>{
      camera.aspect=innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth,innerHeight);
    });
  </script>
</body>
</html>
